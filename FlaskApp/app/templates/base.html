<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{% block title %}Accounting{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='base.css') }}">
</head>

<body>
  <header class="app-header">
    <div class="header-top">
      <h1>Accounting Dashboard</h1>

      <div class="auth-links">
      {% if is_logged_in %}
        <div class="user-id">User: {{ current_user_id }}</div>
        <a href="{{ url_for('logout') }}">Logout</a>
      {% else %}
        <a href="{{ url_for('login') }}">Login</a>
      {% endif %}
    </div>

    </div>

    {% if all_entities|length > 1 %}
      <form method="post" action="{{ url_for('app_ui.set_entity') }}">
        <select name="entity" onchange="this.form.submit()">
          {% for e in all_entities %}
            <option value="{{ e.name }}"
              {% if e.name == current_entity %}selected{% endif %}>
              {{ e.name }}
            </option>
          {% endfor %}
        </select>
      </form>
    {% else %}
      <span class="entity-label">{{ current_entity }}</span>
    {% endif %}
    
    <details class="add-entity" style="margin-top:0.5rem;">
      <summary style="cursor:pointer;">Add entity</summary>
      <form method="post" action="{{ url_for('app_ui.add_entity') }}" style="margin-top:0.5rem; display:flex; gap:0.5rem; flex-wrap:wrap; align-items:end;">
        <label style="display:flex; flex-direction:column; font-size:0.9rem;">
          <span>Name</span>
          <input type="text" name="entity_name" required placeholder="e.g. Acme Pty Ltd">
        </label>
        <label style="display:flex; flex-direction:column; font-size:0.9rem;">
          <span>Type</span>
          <input type="text" name="entity_type" placeholder="company / trust / personal">
        </label>
        <label style="display:flex; flex-direction:column; font-size:0.9rem; min-width:260px;">
          <span>Description</span>
          <input type="text" name="entity_description" placeholder="Optional">
        </label>
        <button type="submit">Create</button>
      </form>
    </details>


<nav class="app-nav">
      <!-- Profit & Loss -->
      <form class="report-form" id="pnl-form" onsubmit="return false;">
        <a href="/reports/pnl">P&amp;L</a>

        <label>
          <span>From</span>
          <input type="date" id="pnl-start">
        </label>

        <label>
          <span>To</span>
          <input type="date" id="pnl-end">
        </label>

        <button type="button" onclick="goPnL()">Run</button>
      </form>

      <!-- Balance Sheet -->
      <form class="report-form" id="bs-form" onsubmit="return false;">
        <a href="/reports/balance-sheet">Balance Sheet</a>

        <label>
          <span>As of</span>
          <input type="date" id="bs-asof">
        </label>

        <button type="button" onclick="goBalanceSheet()">Run</button>
      </form>
      <!-- Accounts -->
      <form class="report-form" onsubmit="return false;">
        <a href="/accounts">Accounts</a>
      </form>

      <!-- Transaction Search -->
      <form class="report-form" id="txn-search" method="get" action="{{ url_for('transactions_ui.list') }}">
        <a href="{{ url_for('transactions_ui.list') }}">Transactions</a>
        <label>
          <span>Search</span>
          <input type="text" name="q" placeholder="Desc or amountâ€¦" value="">
        </label>
        <button type="submit">Go</button>
      </form>
    </nav>

    <script>
      function goPnL(){
        const start = document.getElementById("pnl-start").value;
        const end = document.getElementById("pnl-end").value;

        if(!start || !end){
          window.location.href = "/reports/pnl";
          return;
        }

        const qs = new URLSearchParams({ start, end }).toString();
        window.location.href = "/reports/pnl?" + qs;
      }

      function goBalanceSheet(){
        const asof = document.getElementById("bs-asof").value;

        if(!asof){
          window.location.href = "/reports/balance-sheet";
          return;
        }

        const qs = new URLSearchParams({ asof }).toString();
        window.location.href = "/reports/balance-sheet?" + qs;
      }
    </script>
  </header>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="flash-messages" style="margin: 1rem 0;">
        {% for category, message in messages %}
          <div class="flash {{ category }}" style="padding:0.5rem 0.75rem; border:1px solid #ddd; border-radius:6px; margin-bottom:0.5rem;">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  {% block content %}{% endblock %}

</body>
</html>